datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

generator client {
  provider = "prisma-client-js"
}

model User {
  uid            String   @id
  name           String?
  walletAddress  String?
  email          String
  githubUsername String?
  changes        Change[]
  votes          Vote[]
}

model Document {
  did          String   @id @default(uuid())
  name         String   @unique
  description  String?  @db.Text
  owner        String
  repo         String
  chaptersFile String
  changes      Change[]
}

model Change {
  cid              String   @id // the sha256 of owner/repo/prNumber
  suggestor        User     @relation(fields: [suggestorId], references: [uid])
  suggestorId      String
  prNumber         Int
  document         Document @relation(fields: [documentId], references: [did])
  documentId       String
  votes            Vote[]
  title            String
  published        Boolean

  lastEditFilePath String?
  lastEditFileSha  String?
  branchName       String
  merged           Boolean

  @@index([suggestorId, documentId])
}

model Vote {
  vid      String @id @default(uuid())
  voter    User   @relation(fields: [voterId], references: [uid])
  voterId  String
  change   Change @relation(fields: [changeId], references: [cid])
  changeId String
  vote     Int

  @@index([voterId, changeId])
  @@unique([voterId, changeId])
}
